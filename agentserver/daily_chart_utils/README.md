## utils.py


# Stock Realtime API 서비스
FastAPI 기반 한국 주식 실시간 호가창 데이터 제공 API 서비스

## 개요
- **목적**: 한국투자증권 API 연동을 통해 지정 종목의 실시간 호가창 데이터 제공
- **기능**: 종목명/코드 입력 시 매수/매도 호가, 시간대별 잔량 등 호가 데이터 JSON 

- **기술 스택**: 
  - `Python 3.8+`, `FastAPI`, `uvicorn`
  - `mojito2`(한국투자증권 API 래퍼)
  - `python-dotenv`(환경변수 관리)

## 🚀 1. 주요 기능 
### ✅ **실시간 호가 조회**  
- 10단계 매수/매도 호가(가격, 잔량)  
- 전체 매수/매도 누적 잔량  
- 데이터 갱신 시간 정보  

- **응답 데이터 구조 예시**:

| 필드         | 설명                          | 예시 값                   |
|--------------|-------------------------------|--------------------------|
| `company`    | 종목명                        | "네이버"                 |
| `code`       | 종목코드                      | "035420"                |
| `timestamp`  | 호가 접수 시간 (HHMMSS)       | "101506" → 10:15:06    |
| `asks`       | 매도호가(10단계)[가격↓순]     | 230,000원 ~ 234,500원  |
| `bids`       | 매수호가(10단계)[가격↓순]     | 229,500원 ~ 225,000원  |
| `total_ask`  | 총 매도 잔량                  | 83,292주               |
| `total_bid`  | 총 매수 잔량                  | 62,154주               |



### ✅ **유연한 종목 검색**  
- 종목명(`네이버`) 또는 종목코드(`035420`) 모두 지원 

## 🚀 2. 주요 기능
### ✅ **에러 핸들링**  
- 잘못된 종목 입력 시 404 에러 반환  
- API 호출 실패 시 상세 에러 메시지 제공  
- **지원 종목 목록**:
   
| 네이버 `035420` | 크래프톤 `259960` | CJ제일제당 `097950` |  
| LG화학 `051910` | SK케미칼 `285130` | SK하이닉스 `000660` |  
| 롯데렌탈 `089860` | 엘앤에프 `066970` | 카카오뱅크 `323410` |  
| 한화솔루션 `009830` |


> 💡 주의: 상기 종목은 기본 제공 목록이며, 코드 내 `target_stocks` 변수 수정으로 확장 가능

# ⚙️ 설치 및 실행

## 필수 조건
- Python 3.8 이상
- 패키지 설치:  pip install fastapi uvicorn mojito2 python-dotenv requests



## 환경 변수 설정 상세 설명
프로젝트 정상 작동을 위해 **3개의 필수 환경변수**가 필요합니다.  
아래 가이드에 따라 `.env` 파일을 생성해주세요.

### 1. 환경변수 목록
| 변수명                   | 설명                                  | 예시 값             | 필수 여부 |
|--------------------------|--------------------------------------|--------------------|----------|
| `KOREAINVESTMENT_KEY`    | 한국투자증권 Open API 액세스 키       | `"your_api_key"`  | ✅ 필수  |
| `KOREAINVESTMENT_SECRET` | 한국투자증권 Open API 시크릿 키       | `"your_secret"`    | ✅ 필수  |
| `KOREAINVESTMENT_ACC_NO` | 계좌번호(하이픈 포함 8자리)          | `"123456-78"`      | ✅ 필수  |

### 2. 설정 방법
1. **모의투자 계좌 생성**  
   [한국투자증권 모의투자 가입](https://sim.koreainvestment.com/) 후 계좌 개설

2. **API 키 발급**  
   - 개발자센터 접속: [KIS Developers Console](https://apiportal.koreainvestment.com/)
   - 모의투자 API 선택 → App Key & Secret 발급  

3. **계좌번호 확인**  
   모의투자 화면 → [계좌관리] 메뉴에서 `123456-78` 형식 확인  

4. **.env 파일 작성**  
   프로젝트 루트에 `.env` 파일 생성 후 아래 포맷 적용:

